<!DOCTYPE html>
<html lang="es">

<%- include('../partials/head', { title : 'Inicio' }); -%>

<body>

    <%- include('../partials/header'); -%>

    <main>
        <section>
            <div id="products-wrapper">
                ðŸ™„
            </div>
            <%- include('../partials/products/form'); -%>
        </section>
    </main>

    <%- include('../partials/footer'); -%>

    <script>
        const PRODUCTS_UTILS = {
            productsListView: async () => {
                const productsView = await fetch('/products');
                document.getElementById("products-wrapper").innerHTML = await productsView.text();
            },
            productsAdd: () => {
                socket.emit('products-add', {
                    name: 'asdfasdfasdfasdfasdf',
                    price: 213123132,
                    thumbnail: 'asdfasdf'
                })
            }
        };

        (async () => {        
            await PRODUCTS_UTILS.productsListView();
        })();

        const socket = io();

        socket.on('products-list', () => {
            // Hago un fetch para cargar los productos en lugar de recibirlo por acÃ¡
            PRODUCTS_UTILS.productsListView();
        });

        document.getElementById('products-add-button').onclick = e => {
            e.preventDefault();
            PRODUCTS_UTILS.productsAdd();
        };

    </script>

</body>

</html>